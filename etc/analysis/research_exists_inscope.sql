
-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- 
-- existsSubQuery と inScopeSubQuery のパフォーマンスの違い
-- 
-- _/_/_/_/
-- GIANT :: 300万件
-- GIANT_REF :: 1000万件

-- =======================================================================================
--                                                                       外側多くて内側少ない
--                                                                       =================
-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- まず内側サブクエリの想定件数の確認
-- _/_/_/_/
select count(*)
  from GIANT_REF ref
 where ref.INDEX_DATE = '2000-01-01'
+----------+
| count(*) |
+----------+
|      152 |
+----------+
1 row in set (0.01 sec)




-- ---------------------------------------------------------
--                                           exists SubQuery
--                                           ---------------
select count(*)
  from GIANT gi
 where exists (select ref.GIANT_REF_ID
                 from GIANT_REF ref
                where ref.GIANT_ID = gi.GIANT_ID
                  and ref.INDEX_DATE = '2000-01-01'
       )

-- (MySQL-5.7.13) => 期待通り遅い (DEPENDENT SUBQUERY)
+----------+
| count(*) |
+----------+
|      152 |
+----------+
1 row in set (1 min 59.53 sec)
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+---------+----------+--------------------------+
| id | select_type        | table | partitions | type  | possible_keys                                                  | key                                    | key_len | ref                   | rows    | filtered | Extra                    |
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+---------+----------+--------------------------+
|  1 | PRIMARY            | gi    | NULL       | index | NULL                                                           | IX_GIANT_INDEX_BOOLEAN                 | 1       | NULL                  | 2897937 |   100.00 | Using where; Using index |
|  2 | DEPENDENT SUBQUERY | ref   | NULL       | ref   | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | 8       | maihamadb.gi.GIANT_ID |       3 |     1.51 | Using where              |
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+---------+----------+--------------------------+
2 rows in set, 2 warnings (0.01 sec)
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                     |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'maihamadb.gi.GIANT_ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                                                           |
| Note  | 1003 | /* select#1 */
select count(0) AS `count(*)`
  from `maihamadb`.`giant` `gi`
 where exists(/* select#2 */ select `maihamadb`.`ref`.`GIANT_REF_ID`
                               from `maihamadb`.`giant_ref` `ref`
                             where ((`maihamadb`.`ref`.`INDEX_DATE` = '2000-01-01')
                               and (`maihamadb`.`ref`.`GIANT_ID` = `maihamadb`.`gi`.`GIANT_ID`))) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


-- (MySQL-8.0.36) => おお、速い！ (MATERIALIZED, semi join)
+----------+
| count(*) |
+----------+
|      152 |
+----------+
1 row in set (0.08 sec)
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
| id | select_type  | table       | partitions | type   | possible_keys                                                  | key                     | key_len | ref                  | rows | filtered | Extra       |
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
|  1 | SIMPLE       | <subquery2> | NULL       | ALL    | NULL                                                           | NULL                    | NULL    | NULL                 | NULL |   100.00 | NULL        |
|  1 | SIMPLE       | gi          | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                 | 8       | <subquery2>.GIANT_ID |    1 |   100.00 | Using index |
|  2 | MATERIALIZED | ref         | NULL       | ref    | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_INDEX_DATE | 3       | const                |  152 |   100.00 | NULL        |
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
3 rows in set, 2 warnings (0.00 sec)
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                       |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'maihamadb.gi.GIANT_ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                             |
| Note  | 1003 | /* select#1 */ select count(0) AS `count(*)`
                                  from `maihamadb`.`giant` `gi`
                                    semi join (`maihamadb`.`giant_ref` `ref`)
                                 where ((`maihamadb`.`gi`.`GIANT_ID` = `<subquery2>`.`GIANT_ID`)
                                   and (`maihamadb`.`ref`.`INDEX_DATE` = DATE'2000-01-01')) |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.00 sec)
| -> Aggregate: count(0)  (cost=218 rows=1) (actual time=4.36..4.36 rows=1 loops=1)
    -> Nested loop inner join  (cost=203 rows=152) (actual time=2.69..4.34 rows=152 loops=1)
        -> Table scan on <subquery2>  (cost=182..187 rows=152) (actual time=2.62..2.64 rows=152 loops=1)
            -> Materialize with deduplication  (cost=182..182 rows=152) (actual time=2.62..2.62 rows=152 loops=1)
                -> Index lookup on ref using IX_GIANT_REF_INDEX_DATE (INDEX_DATE=DATE'2000-01-01')  (cost=167 rows=152) (actual time=1.88..2.56 rows=152 loops=1)
        -> Single-row covering index lookup on gi using PRIMARY (GIANT_ID=`<subquery2>`.GIANT_ID)  (cost=1.1 rows=1) (actual time=0.0109..0.011 rows=1 loops=152)
 |




-- ---------------------------------------------------------
--                                          inScope SubQuery
--                                          ----------------
select count(*)
  from GIANT gi
 where gi.GIANT_ID in (select ref.GIANT_ID
                         from GIANT_REF ref
                        where ref.INDEX_DATE = '2000-01-01'
       )


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-5.7.13) => 期待通り速い
-- _/_/_/_/
+----------+
| count(*) |
+----------+
|      152 |
+----------+
1 row in set (0.02 sec)
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
| id | select_type  | table       | partitions | type   | possible_keys                                                  | key                     | key_len | ref                  | rows | filtered | Extra       |
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
|  1 | SIMPLE       | <subquery2> | NULL       | ALL    | NULL                                                           | NULL                    | NULL    | NULL                 | NULL |   100.00 | NULL        |
|  1 | SIMPLE       | gi          | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                 | 8       | <subquery2>.GIANT_ID |    1 |   100.00 | Using index |
|  2 | MATERIALIZED | ref         | NULL       | ref    | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_INDEX_DATE | 3       | const                |  152 |   100.00 | NULL        |
+----+--------------+-------------+------------+--------+----------------------------------------------------------------+-------------------------+---------+----------------------+------+----------+-------------+
3 rows in set, 1 warning (0.00 sec)
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                   |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */
select count(0) AS `count(*)`
  from `maihamadb`.`giant` `gi`
    semi join (`maihamadb`.`giant_ref` `ref`)
 where ((`maihamadb`.`gi`.`GIANT_ID` = `<subquery2>`.`GIANT_ID`)
   and (`maihamadb`.`ref`.`INDEX_DATE` = '2000-01-01')) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-8.0.36) => 変わらず速い
-- (ここはあまり意味がないので詳細は省略)
-- _/_/_/_/





-- =======================================================================================
--                                                                       外側少なくて内側多い
--                                                                       =================
-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- まず内側サブクエリの想定件数の確認
-- _/_/_/_/
select count(*)
  from GIANT_REF ref
 where ref.INDEX_DATE >= '2024-03-21'
+----------+
| count(*) |
+----------+
|  8785935 |
+----------+
1 row in set (1.52 sec)

select count(*)
  from GIANT gi
 where gi.INDEX_INTEGER >= 95
   and gi.INDEX_INTEGER < 100
+----------+
| count(*) |
+----------+
|     1500 |
+----------+
1 row in set (0.01 sec)




-- ---------------------------------------------------------
--                                           exists SubQuery
--                                           ---------------
select count(*)
  from GIANT gi
 where exists (select ref.GIANT_ID
                 from GIANT_REF ref
                where ref.GIANT_ID = gi.GIANT_ID
                  and ref.INDEX_DATE >= '2024-03-21'
       )
   and gi.INDEX_INTEGER >= 95
   and gi.INDEX_INTEGER < 100


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-5.7.13) => 期待通り速い
-- o DEPENDENT SUBQUERY でフィットするパターン
-- _/_/_/_/
+----------+
| count(*) |
+----------+
|     1417 |
+----------+
1 row in set (0.34 sec)
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+--------------------------+
| id | select_type        | table | partitions | type  | possible_keys                                                  | key                                    | key_len | ref                   | rows | filtered | Extra                    |
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+--------------------------+
|  1 | PRIMARY            | gi    | NULL       | range | IX_GIANT_INDEX_INTEGER                                         | IX_GIANT_INDEX_INTEGER                 | 4       | NULL                  | 1500 |   100.00 | Using where; Using index |
|  2 | DEPENDENT SUBQUERY | ref   | NULL       | ref   | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | 8       | maihamadb.gi.GIANT_ID |    3 |    50.00 | Using where              |
+----+--------------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+--------------------------+
2 rows in set, 2 warnings (0.01 sec)
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                                                                              |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'maihamadb.gi.GIANT_ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                                                                                                                                                    |
| Note  | 1003 | /* select#1 */
select count(0) AS `count(*)`
  from `maihamadb`.`giant` `gi`
 where (exists(/* select#2 */ select `maihamadb`.`ref`.`GIANT_ID`
                                from `maihamadb`.`giant_ref` `ref`
                               where ((`maihamadb`.`ref`.`GIANT_ID` = `maihamadb`.`gi`.`GIANT_ID`)
                                 and (`maihamadb`.`ref`.`INDEX_DATE` >= '2024-03-21'))
              )
   and (`maihamadb`.`gi`.`INDEX_INTEGER` >= 95)
   and (`maihamadb`.`gi`.`INDEX_INTEGER` < 100)) |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-8.0.36) => 変わらず速いが...
-- o DEPENDENT SUBQUERY が消えて FirstMatch になった (semi join)
-- _/_/_/_/
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
| id | select_type | table | partitions | type  | possible_keys                                                  | key                                    | key_len | ref                   | rows | filtered | Extra                       |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
|  1 | SIMPLE      | gi    | NULL       | range | PRIMARY,IX_GIANT_INDEX_INTEGER                                 | IX_GIANT_INDEX_INTEGER                 | 4       | NULL                  | 1500 |   100.00 | Using where; Using index    |
|  1 | SIMPLE      | ref   | NULL       | ref   | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | 8       | maihamadb.gi.GIANT_ID |    3 |    50.00 | Using where; FirstMatch(gi) |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
2 rows in set, 2 warnings (0.01 sec)
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                      |
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'maihamadb.gi.GIANT_ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                                                                                            |
| Note  | 1003 | /* select#1 */ select count(0) AS `count(*)`
                                  from `maihamadb`.`giant` `gi` semi join (`maihamadb`.`giant_ref` `ref`)
                                 where ((`maihamadb`.`ref`.`GIANT_ID` = `maihamadb`.`gi`.`GIANT_ID`)
                                   and (`maihamadb`.`gi`.`INDEX_INTEGER` >= 95)
                                   and (`maihamadb`.`gi`.`INDEX_INTEGER` < 100) and (`maihamadb`.`ref`.`INDEX_DATE` >= DATE'2024-03-21')) |
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.00 sec)
| -> Aggregate: count(0)  (cost=5702 rows=1) (actual time=19.3..19.3 rows=1 loops=1)
    -> Nested loop semijoin  (cost=5460 rows=2420) (actual time=0.12..19.3 rows=1417 loops=1)
        -> Filter: ((gi.INDEX_INTEGER >= 95) and (gi.INDEX_INTEGER < 100))  (cost=303 rows=1500) (actual time=0.0365..0.627 rows=1500 loops=1)
            -> Covering index range scan on gi using IX_GIANT_INDEX_INTEGER over (95 <= INDEX_INTEGER < 100)  (cost=303 rows=1500) (actual time=0.034..0.457 rows=1500 loops=1)
        -> Filter: (ref.INDEX_DATE >= DATE'2024-03-21')  (cost=5.03 rows=1.61) (actual time=0.0123..0.0123 rows=0.945 loops=1500)
            -> Index lookup on ref using IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER (GIANT_ID=gi.GIANT_ID)  (cost=5.03 rows=3.23) (actual time=0.0121..0.0122 rows=1.07 loops=1500)
 |




-- ---------------------------------------------------------
--                                          inScope SubQuery
--                                          ----------------
select count(*)
  from GIANT gi
 where gi.GIANT_ID in (select ref.GIANT_ID
                         from GIANT_REF ref
                        where ref.INDEX_DATE >= '2024-03-21'
       )
   and gi.INDEX_INTEGER >= 95
   and gi.INDEX_INTEGER < 100


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-5.7.13) => おお、速い
-- o サブクエリがsemi joinにされているので内側テーブルスキャン回避されてる
-- o そういう意味では、5.6のときはどんなんだったか？知りたいところだが環境がない
-- _/_/_/_/
+----------+
| count(*) |
+----------+
|     1417 |
+----------+
1 row in set (0.30 sec)
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
| id | select_type | table | partitions | type  | possible_keys                                                  | key                                    | key_len | ref                   | rows | filtered | Extra                       |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
|  1 | SIMPLE      | gi    | NULL       | range | PRIMARY,IX_GIANT_INDEX_INTEGER                                 | IX_GIANT_INDEX_INTEGER                 | 4       | NULL                  | 1500 |   100.00 | Using where; Using index    |
|  1 | SIMPLE      | ref   | NULL       | ref   | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | 8       | maihamadb.gi.GIANT_ID |    3 |    50.00 | Using where; FirstMatch(gi) |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
2 rows in set, 1 warning (0.00 sec)
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                  |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */
select count(0) AS `count(*)`
  from `maihamadb`.`giant` `gi`
    semi join (`maihamadb`.`giant_ref` `ref`)
 where ((`maihamadb`.`ref`.`GIANT_ID` = `maihamadb`.`gi`.`GIANT_ID`)
   and (`maihamadb`.`gi`.`INDEX_INTEGER` >= 95)
   and (`maihamadb`.`gi`.`INDEX_INTEGER` < 100)
   and (`maihamadb`.`ref`.`INDEX_DATE` >= '2024-03-21')) |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


-- _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
-- (MySQL-8.0.36) => 変わらず速い
-- _/_/_/_/
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
| id | select_type | table | partitions | type  | possible_keys                                                  | key                                    | key_len | ref                   | rows | filtered | Extra                       |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
|  1 | SIMPLE      | gi    | NULL       | range | PRIMARY,IX_GIANT_INDEX_INTEGER                                 | IX_GIANT_INDEX_INTEGER                 | 4       | NULL                  | 1500 |   100.00 | Using where; Using index    |
|  1 | SIMPLE      | ref   | NULL       | ref   | IX_GIANT_REF_INDEX_DATE,IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER | 8       | maihamadb.gi.GIANT_ID |    3 |    50.00 | Using where; FirstMatch(gi) |
+----+-------------+-------+------------+-------+----------------------------------------------------------------+----------------------------------------+---------+-----------------------+------+----------+-----------------------------+
2 rows in set, 1 warning (0.00 sec)
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                      |
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select count(0) AS `count(*)`
                                  from `maihamadb`.`giant` `gi`
                                    semi join (`maihamadb`.`giant_ref` `ref`)
                                 where ((`maihamadb`.`ref`.`GIANT_ID` = `maihamadb`.`gi`.`GIANT_ID`)
                                   and (`maihamadb`.`gi`.`INDEX_INTEGER` >= 95)
                                   and (`maihamadb`.`gi`.`INDEX_INTEGER` < 100)
                                   and (`maihamadb`.`ref`.`INDEX_DATE` >= DATE'2024-03-21')) |
+-------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
| -> Aggregate: count(0)  (cost=5702 rows=1) (actual time=22.5..22.5 rows=1 loops=1)
    -> Nested loop semijoin  (cost=5460 rows=2420) (actual time=0.104..22.4 rows=1417 loops=1)
        -> Filter: ((gi.INDEX_INTEGER >= 95) and (gi.INDEX_INTEGER < 100))  (cost=303 rows=1500) (actual time=0.0408..0.646 rows=1500 loops=1)
            -> Covering index range scan on gi using IX_GIANT_INDEX_INTEGER over (95 <= INDEX_INTEGER < 100)  (cost=303 rows=1500) (actual time=0.0386..0.47 rows=1500 loops=1)
        -> Filter: (ref.INDEX_DATE >= DATE'2024-03-21')  (cost=5.03 rows=1.61) (actual time=0.0144..0.0144 rows=0.945 loops=1500)
            -> Index lookup on ref using IX_GIANT_REF_COMPOUND_GIANT_ID_INTEGER (GIANT_ID=gi.GIANT_ID)  (cost=5.03 rows=3.23) (actual time=0.0142..0.0142 rows=1.07 loops=1500)
 |

